# Maxim-Krivobokov_infra

##Google Cloud App Deploy
testapp_IP = 35.187.167.214
testapp_port = 9292

Что сделал в этом Д\З:
*установил и настроил Gcloud SDK на локальной машине
*создал виртуальную машину reddit-app, настроил ssh соединение с ней
*установил Ruby и Bundler
*установил Mongo-DB, запустил и добавил в автозапуск
*скопировал код приложения reddit с гитхаба
* установил зависимости с помощью bundle
*запустил сервер Puma
*добавил праивло в файерволе GCP для сервера Puma
*создал скрипты install_ruby.sh install_mongodb.sh deploy.sh для автоматизации вышеупомянутых действий
* проверил срипты на другом инстансе, работают корректно
*создал файл-срипт для gcloud, который запускает инстанс, и подцепляет скрипт из файлы или url. 
	* ОШИБКА - копирует репозиторий, а дальше выполнение под вопросом, сервер Puma не установлен. Требуется доработка




## Google Cloud Bastion host

Панель управления VPN доступна по адресу https://35.240.16.5
```
bastion_IP = 35.240.16.5
someinternalhost_IP = 10.132.0.3
```

### Доступ по ssh во внутреннюю сеть через bastion хост
* Соединение по SSH к хосту someinternalhost одной командой:
```
ssh -i ~/.ssh/<закрытый ключ> -A <username>@35.240.16.5 -tt 10.132.0.3
```
Для создания alias необходимо отредактировать файл `~/.ssh/config` и внести туда следующие настройки:
```
Host someinternalhost
	HostName 10.132.0.3
	User <username>
	IdentityFile ~/.ssh/<закрытый ключ>
	ProxyCommand ssh -A 35.240.16.5 nc %h %p
```

Теперь команда `ssh someinternalhost` будет создавать подключение к машине someinternalhost внутри приватной сети через бастион. 





